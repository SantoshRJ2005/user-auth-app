<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View Drivers | SharingYatra</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    :root {
      --primary-color: #ff6b4a;
      --secondary-color: #2c3e50;
      --light-gray: #f4f4f4;
      --dark-gray: #555;
      --white: #ffffff;
      --success: #28a745;
      --danger: #dc3545;
      --info: #007bff;
      --warning: #ffc107;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body { display: flex; background: var(--light-gray); }

    .sidebar { width: 250px; height: 100vh; background: var(--secondary-color); padding: 30px 20px; color: var(--white); position: fixed; top: 0; left: 0; }
    .sidebar h2 { color: var(--primary-color); font-size: 24px; margin-bottom: 30px; }
    .sidebar a { display: block; color: var(--white); text-decoration: none; padding: 10px; margin-bottom: 10px; border-left: 3px solid transparent; transition: all 0.3s ease; }
    .sidebar a:hover, .sidebar a.active { color: var(--primary-color); border-left: 3px solid var(--primary-color); background: rgba(255,255,255,0.1); }

    .main { flex: 1; padding: 30px; margin-left: 250px; }
    h1 { margin-bottom: 20px; color: var(--secondary-color); }

    .table-container { background: var(--white); border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); overflow: hidden; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 15px; text-align: left; }
    th { background-color: var(--secondary-color); color: var(--white); font-weight: 600; }
    tr:nth-child(even) { background-color: var(--light-gray); }
    td.actions-cell { display: flex; gap: 10px; align-items: center; }

    .action-btn { padding: 8px 12px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; color: var(--white); transition: opacity 0.3s; }
    .action-btn:hover { opacity: 0.8; }
    .edit-btn { background-color: var(--warning); }
    .delete-btn { background-color: var(--danger); }

    .alert { padding: 15px; margin-bottom: 20px; border-radius: 4px; font-size: 16px; }
    .alert-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .alert-info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }

    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 100; display: none; align-items: center; justify-content: center; }
    .modal-content { background: var(--white); padding: 30px; border-radius: 8px; width: 90%; max-width: 500px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    .modal-content h2 { color: var(--secondary-color); margin-bottom: 20px; }
    .modal-content .form-group { margin-bottom: 15px; }
    .modal-content label { display: block; margin-bottom: 5px; font-weight: 600; color: var(--dark-gray); }
    .modal-content input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
    .modal-actions { margin-top: 20px; text-align: right; }
    .modal-actions button { padding: 10px 20px; margin-left: 10px; }
    .btn-cancel { background: #6c757d; }
  </style>
</head>
<body>

<div class="sidebar">
  <h2>SharingYatra</h2>
  <a href="/manageBooking">Manage Bookings</a>
  <a href="/addDriver">Add Drivers</a>
  <a href="/viewDriver" class="active">View Drivers</a>
  <a href="#">Vehicles</a>
  <a href="/dashboard">Profile</a>
  <a href="/logout">Logout</a>
</div>

<div class="main">
  <h1>View All Drivers Details</h1>
  <% if (error) { %>
    <div class="alert alert-error"><%= error %></div>
  <% } %>
  <% if (drivers.length === 0 && !error) { %>
    <div class="alert alert-info">No drivers found. Please add a driver to your agency.</div>
  <% } else { %>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Full Name</th>
            <th>Email</th>
            <th>Phone Number</th>
            <th>License Number</th>
            <th>Vehicle Model</th>
            <th>Plate Number</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% drivers.forEach(driver => { %>
            <tr>
              <td><%= driver.fullName || '' %></td>
              <td><%= driver.email || '' %></td>
              <td><%= driver.mobile || '' %></td>
              <td><%= driver.licenseNumber || '' %></td>
              <td><%= driver.assignedVehicle && driver.assignedVehicle.vehicle_name ? driver.assignedVehicle.vehicle_name : '' %></td>
              <td><%= driver.assignedVehicle && driver.assignedVehicle.number_plate ? driver.assignedVehicle.number_plate : '' %></td>
              <td class="actions-cell">
                <button 
                  class="action-btn edit-btn" 
                  title="Edit"
                  data-id="<%= driver._id || '' %>"
                  data-fullname="<%= driver.fullName || '' %>"
                  data-email="<%= driver.email || '' %>"
                  data-phone="<%= driver.mobile || '' %>"
                  data-license="<%= driver.licenseNumber || '' %>"
                  data-address="<%= driver.address || '' %>"
                  data-vehiclemodel="<%= driver.assignedVehicle && driver.assignedVehicle.vehicle_name ? driver.assignedVehicle.vehicle_name : '' %>"
                  data-vehicleplatenumber="<%= driver.assignedVehicle && driver.assignedVehicle.number_plate ? driver.assignedVehicle.number_plate : '' %>"
                >
                  <i class="fa-solid fa-pen-to-square"></i> Edit
                </button>
                <button 
                  class="action-btn delete-btn" 
                  title="Delete" 
                  data-id="<%= driver._id || '' %>"
                >
                  <i class="fa-solid fa-trash"></i> Delete
                </button>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } %>
</div>

<div id="editModal" class="modal-overlay">
  <div class="modal-content">
    <h2>Edit Driver Details</h2>
    <form id="editForm" action="/editDriver" method="POST">
      <input type="hidden" id="editDriverId" name="driverId">
      <div class="form-group">
        <label for="editFullName">Full Name</label>
        <input type="text" id="editFullName" name="fullName" required>
      </div>
      <div class="form-group">
        <label for="editEmail">Email</label>
        <input type="email" id="editEmail" name="email" required>
      </div>
      <div class="form-group">
        <label for="editPhoneNumber">Phone Number</label>
        <input type="tel" id="editPhoneNumber" name="phoneNumber" required>
      </div>
      <div class="form-group">
        <label for="editLicenseNumber">License Number</label>
        <input type="text" id="editLicenseNumber" name="licenseNumber" required>
      </div>
      <div class="form-group">
        <label for="editAddress">Address</label>
        <input type="text" id="editAddress" name="address">
      </div>
      <div class="form-group">
        <label for="editVehicleModel">Vehicle Model</label>
        <input type="text" id="editVehicleModel" name="vehicleModel">
      </div>
      <div class="form-group">
        <label for="editVehiclePlateNumber">Plate Number</label>
        <input type="text" id="editVehiclePlateNumber" name="vehiclePlateNumber">
      </div>
      <div class="modal-actions">
        <button type="button" class="action-btn btn-cancel" onclick="closeModal('editModal')">Cancel</button>
        <button type="submit" class="action-btn edit-btn">Save Changes</button>
      </div>
    </form>
  </div>
</div>

<div id="deleteModal" class="modal-overlay">
  <div class="modal-content">
    <h2>Confirm Deletion</h2>
    <p>Are you sure you want to permanently delete this driver? This action cannot be undone.</p>
    <form id="deleteForm" action="/deleteDriver" method="POST">
      <input type="hidden" id="deleteDriverId" name="driverId">
      <div class="modal-actions">
        <button type="button" class="action-btn btn-cancel" onclick="closeModal('deleteModal')">Cancel</button>
        <button type="submit" class="action-btn delete-btn">Delete</button>
      </div>
    </form>
  </div>
</div> 

<script>
function openModal(modalId) {
  document.getElementById(modalId).style.display = 'flex';
}
function closeModal(modalId) {
  document.getElementById(modalId).style.display = 'none';
}
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.edit-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.getElementById('editDriverId').value = btn.dataset.id || '';
      document.getElementById('editFullName').value = btn.dataset.fullname || '';
      document.getElementById('editEmail').value = btn.dataset.email || '';
      document.getElementById('editPhoneNumber').value = btn.dataset.phone || '';
      document.getElementById('editLicenseNumber').value = btn.dataset.license || '';
      document.getElementById('editAddress').value = btn.dataset.address || '';
      document.getElementById('editVehicleModel').value = btn.dataset.vehiclemodel || '';
      document.getElementById('editVehiclePlateNumber').value = btn.dataset.vehicleplatenumber || '';
      openModal('editModal');
    });
  });
  document.querySelectorAll('.delete-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.getElementById('deleteDriverId').value = btn.dataset.id || '';
      openModal('deleteModal');
    });
  });
  window.onclick = function(event) {
    if (event.target.classList.contains('modal-overlay')) {
      closeModal('editModal');
      closeModal('deleteModal');
    }
  }
});
</script>
</body>
</html>
